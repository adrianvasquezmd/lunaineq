% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/aci_luna.R
\name{aci_luna}
\alias{aci_luna}
\title{Absolute Concentration Index (two input modes and two methods)}
\usage{
aci_luna(
  health_indicator_type = NULL,
  unit_analysis = NULL,
  health_indicator = NULL,
  population_weights = NULL,
  health_numerator = NULL,
  health_denominator = NULL,
  equity_stratifier = NULL,
  higher_ineq_is_favorable = NULL,
  rate_scaling_factor = NULL,
  calculation_method = NULL,
  smoothing_factor = NULL,
  integration_method = NULL,
  conf_level = NULL,
  language_interpretation = NULL
)
}
\arguments{
\item{health_indicator_type}{Character string: either \code{"proportion"} for bounded indicators in \eqn{[0,1]}, or \code{"rate"} if already scaled (e.g., deaths per 100,000); required in all cases.}

\item{health_indicator}{Numeric vector with the health indicator values (e.g., \code{c(0.12, 0.34)} for proportions or \code{c(120, 345)} for rates); aggregated value per unit; used only in Mode B.}

\item{population_weights}{Numeric vector > 0 representing population size or weight per unit (e.g., \code{c(1000, 5000, 1200)}); used only in Mode B.}

\item{health_numerator}{Numeric vector with event counts (e.g., \code{c(5, 12, 8)} for deaths); used only in Mode A and preferred for robust estimation.}

\item{health_denominator}{Numeric vector > 0 associated with \code{health_numerator} (e.g., \code{c(500, 1000, 800)} representing population at risk); used only in Mode A.}

\item{equity_stratifier}{Numeric vector representing the social stratifier (e.g., poverty rate, education index); required in all cases.}

\item{higher_ineq_is_favorable}{Logical; \code{TRUE} if higher values of \code{equity_stratifier} indicate better social conditions (e.g., Gross Domestic Product per capita), or \code{FALSE} if they indicate worse conditions (e.g., Unsatisfied Basic Needs).}

\item{rate_scaling_factor}{Numeric scalar > 0 applied only when \code{health_indicator_type = "rate"}; commonly \code{1000} or \code{100000} (e.g., maternal mortality ratio per 100000 live births).}

\item{calculation_method}{Character string specifying the method used to compute the ACI. Allowed values are \code{"Fuller"} (smoothed Lorenz curve approach) and \code{"WK"} (Wagstaff & Kakwani regression approach). Default is \code{"WK"}.}

\item{smoothing_factor}{Numeric scalar (e.g., \code{0.5}) controlling the smoothness of the curve. Used only when \code{calculation_method = "WK"}; ignored otherwise.}

\item{integration_method}{Character string specifying the optimization algorithm for parameter estimation when \code{calculation_method = "Fuller"}. Allowed values include \code{"BFGS"}, \code{"CG"}, \code{"Nelder-Mead"}, \code{"L-BFGS-B"}, \code{"nlm"}, \code{"nlminb"}, \code{"spg"}, \code{"ucminf"}, \code{"Rcgmin"}, \code{"Rvmmin"}, \code{"newuoa"}, \code{"bobyqa"}, \code{"nmkb"}, and \code{"hjkb"}. Default is \code{"BFGS"}.}

\item{conf_level}{Numeric scalar between 0 and 1 (e.g., \code{0.95}) specifying the confidence level for the ACI estimate. Default is \code{0.95}.}

\item{language_interpretation}{Character string indicating the desired output language for interpretation and note; allowed values are \code{"en"}, \code{"es"}, \code{"fr"}, \code{"pt"} or full names (\code{"english"}, \code{"spanish"}, \code{"french"}, \code{"portuguese"}); default is \code{"en"}.}
}
\value{
A \code{list} with the following components:
\item{summary_table}{A \code{tibble} with the Absolute Concentration Index estimate (\code{estimate}), its confidence interval bounds (\code{ci_lower}, \code{ci_upper}), and the method used (\code{method}).}
\item{interpretation}{Character string with the automatic interpretation of the result in the selected language.}
\item{note}{Character string with the explanatory note in the selected language, based on the type of health indicator.}
\item{global_health_mean}{Overall mean of the health indicator: weighted average (Mode B) or global rate (Mode A).}
\item{data}{Final \code{tibble} used for the calculation, including processed variables and the estimated Lorenz curve.}
}
\description{
Computes the Absolute Concentration Index to quantify socioeconomic-related inequalities in a health indicator.
The function operates in two modes: \strong{(Mode A)} using a numerator and denominator (\code{health_numerator} and \code{health_denominator}),
which is the preferred and most accurate method as it relies directly on event counts; and \strong{(Mode B)} using an aggregated health indicator
(\code{health_indicator}) and population weights (\code{population_weights}), which is used when disaggregated data are not available.
The ACI is estimated using either the Fuller method (area under the symmetric Lorenz curve)
or the Wagstaff & Kakwani method (regression approach). The function also provides automatic interpretations of the results in
four languages: Spanish, English, French, and Portuguese.
}
\details{
\subsection{Estimation methods}{
The Absolute Concentration Index (ACI) can be estimated using two methods:

\describe{
\item{\strong{Wagstaff & Kakwani (WK) method}}{
This method estimates the ACI directly from the observed data without assuming any specific functional form for the concentration curve. The ACI is computed using the formula:

\deqn{\mathrm{ACI} \;=\; \sum_j p_j \cdot (2X_j - 1) \cdot y_j}

where \eqn{p_j} is the population share of subgroup \eqn{j}; \eqn{y_j} is the value of the health indicator in subgroup \eqn{j}; and \eqn{X_j} is the relative rank of subgroup \eqn{j}, calculated as \eqn{X_j = \sum_{i=1}^{j} p_i - 0.5\,p_j}.
}

\item{\strong{Fuller method}}{
This method estimates the ACI by fitting a symmetric Lorenz curve (Murray, 1996). The Lorenz function is:

\deqn{y = \frac{1}{\left( \frac{1}{e^{k - 1}} - 1 \right)} \left( e^{\frac{x}{k - x}} - 1 \right)}

where \eqn{x} is the cumulative population share; \eqn{y} is the cumulative health indicator share; and \eqn{k} is the shape parameter estimated by minimizing the squared error between observed and fitted values.

The ACI corresponds to the area between the fitted curve and the line of equality, scaled by the mean of the health indicator.
}
}
}
}
\note{
Mode B was developed as an alternative for situations where only aggregated
health indicators (e.g., proportions or rates) are available, and the disaggregated
data (numerator and denominator) is not accessible. Although Mode A is more precise,
Mode B still allows for valid inequality comparisons when only summary data is available.
}
\examples{
# ——— Mode A (preferred: numerator and denominator) ———

# Health indicator: Rate. Suppose data1 with:
#   maternal_deaths  = number of maternal deaths.
#   live_births      = number of live births.
#   ubn_percent      = \% of population with at least one unmet basic need (higher = worse social status).
data(data1)
aci_luna(
  health_indicator_type    = "rate",
  unit_analysis            = data1$zone,
  health_numerator         = data1$maternal_deaths,
  health_denominator       = data1$live_births,
  equity_stratifier        = data1$ubn_percent,
  higher_ineq_is_favorable = FALSE,
  rate_scaling_factor      = 100000,
  calculation_method       = "WK",
  smoothing_factor         = 3,
  conf_level               = 0.95,
  language_interpretation  = "en"
)

# Health indicator: Proportion. Suppose data2 with:
#   skilled_births   = number of births attended by skilled personnel.
#   total_births     = total number of births.
#   ubn_index        = \% of population with at least one unmet basic need (higher = worse social status).
data(data2)
aci_luna(
  health_indicator_type    = "proportion",
  unit_analysis            = data2$zone,
  health_numerator         = data2$skilled_births,
  health_denominator       = data2$total_births,
  equity_stratifier        = data2$ubn_percent,
  higher_ineq_is_favorable = FALSE,
  calculation_method       = "Fuller",
  conf_level               = 0.95,
  language_interpretation  = "en"
)

# ——— Mode B (aggregated indicator + population as weight) ———

# Suppose data1 with:
#   mmr       = maternal mortality ratio per 100,000 live births.
#   population = population weight of the unit of analysis.
#   ubn_index = \% of population with at least one unmet basic need.
data(data1)
aci_luna(
  health_indicator_type    = "rate",
  unit_analysis            = data1$zone,
  health_indicator         = data1$mmr,
  equity_stratifier        = data1$ubn_percent,
  population_weights       = data1$population_zone,
  higher_ineq_is_favorable = FALSE,
  rate_scaling_factor      = 100000,
  calculation_method       = "WK",
  smoothing_factor         = 3,
  conf_level               = 0.95,
  language_interpretation  = "en"
)

# Suppose data2 with:
#   skilled_births_prop = proportion of births attended by skilled personnel (in [0,1]).
#   population           = population weight of the unit of analysis.
#   ubn_index            = \% of population with at least one unmet basic need.
data(data2)
aci_luna(
  health_indicator_type    = "proportion",
  unit_analysis            = data2$zone,
  health_indicator         = data2$skilled_births_prop,
  equity_stratifier        = data2$ubn_percent,
  population_weights       = data2$population,
  higher_ineq_is_favorable = FALSE,
  calculation_method       = "Fuller",
  conf_level               = 0.95,
  language_interpretation  = "en"
)

}
\references{
World Health Organization. Handbook on health inequality monitoring with a special focus on low- and middle-income countries. 2013.
Available from: https://www.who.int/publications/i/item/9789241548632
}
\seealso{
\code{stats::smooth.spline}, \code{stats::glm}, \code{optimx::optimx}
}
\author{
Adrián Vázquez-Mejía, MD MSc(c) (\email{apvasquez.md@gmail.com})
\cr Independent Consultant

Oscar J. Mújica, MD MPH (\email{mujicaos@paho.org})
\cr Pan American Health Organization (PAHO), Washington D.C.
}
