% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sii_luna.R
\name{sii_luna}
\alias{sii_luna}
\title{Slope index of inequality (two input modes)}
\usage{
sii_luna(
  health_indicator_type = NULL,
  unit_analysis = NULL,
  health_indicator = NULL,
  population_weights = NULL,
  health_numerator = NULL,
  health_denominator = NULL,
  equity_stratifier = NULL,
  higher_ineq_is_favorable = NULL,
  rate_scaling_factor = NULL,
  models = NULL,
  model_evaluation_metric = NULL,
  conf_level = NULL,
  language_interpretation = NULL
)
}
\arguments{
\item{health_indicator_type}{Character string: either \code{"proportion"} for bounded indicators in \eqn{[0,1]}, or \code{"rate"} if already scaled (e.g., deaths per 100,000); required in all cases.}

\item{health_indicator}{Numeric vector with the health indicator values (e.g., \code{c(0.12, 0.34)} for proportions or \code{c(120, 345)} for rates); aggregated value per unit; used only in Mode B.}

\item{population_weights}{Numeric vector > 0 representing population size or weight per unit (e.g., \code{c(1000, 5000, 1200)}); used only in Mode B.}

\item{health_numerator}{Numeric vector with event counts (e.g., \code{c(5, 12, 8)} for deaths); used only in Mode A and preferred for robust estimation.}

\item{health_denominator}{Numeric vector > 0 associated with \code{health_numerator} (e.g., \code{c(500, 1000, 800)} representing population at risk); used only in Mode A.}

\item{equity_stratifier}{Numeric vector representing the social stratifier (e.g., poverty rate, education index); required in all cases.}

\item{higher_ineq_is_favorable}{Logical; \code{TRUE} if higher values of \code{equity_stratifier} indicate better social conditions (e.g., Gross Domestic Product per capita), or \code{FALSE} if they indicate worse conditions (e.g., Unsatisfied Basic Needs).}

\item{rate_scaling_factor}{Numeric scalar > 0 applied only when \code{health_indicator_type = "rate"}; commonly \code{1000} or \code{100000} (e.g., maternal mortality ratio per 100000 live births).}

\item{models}{Character vector specifying the regression models to evaluate; for proportions: default is \code{c("binomial", "linear logit(y)")} (Mode A) and \code{c("quasibinomial", "linear logit(y)")} (Mode B), allowed models include \code{"linear"}, \code{"linear ln(y)"}, \code{"linear logit(y)"}, \code{"binomial"}, \code{"quasibinomial"}; for rates: default is \code{c("poisson", "negative binomial")} (Mode A) and \code{c("linear ln(y)")} (Mode B), allowed models include \code{"linear"}, \code{"linear ln(y)"}, \code{"poisson"}, \code{"negative binomial"}.}

\item{model_evaluation_metric}{Character string defining the metric for best model selection; allowed values: \code{"MAE"}, \code{"MSE"}, \code{"RMSE"}, \code{"MAPE"}, \code{"AIC"}; default is \code{"MSE"}.}

\item{conf_level}{Numeric scalar between 0 and 1 (e.g., \code{0.95}) specifying the confidence level for inequality estimates; default is \code{0.95}.}

\item{language_interpretation}{Character string indicating the desired output language for interpretation and note; allowed values are \code{"en"}, \code{"es"}, \code{"fr"}, \code{"pt"} or full names (\code{"english"}, \code{"spanish"}, \code{"french"}, \code{"portuguese"}); default is \code{"en"}.}
}
\value{
A \code{list} with components:
\item{summary_table}{A \code{tibble} with \code{inequality_metric}, \code{selected_model}, \code{estimate}, \code{ci_lower}, \code{ci_upper}.}
\item{interpretation}{Character: automatic interpretation in the selected language.}
\item{note}{Character: explanatory note/alerts in the selected language.}
\item{global_health_mean}{Numeric: overall mean of the health indicator (weighted or derived from num/den).}
\item{data}{\code{tibble} used for calculations. Contains at least: \code{health_indicator}, \code{equity_stratifier}, \code{pop_use}, \code{social_position} (ridit), fitted prediction columns for candidate models, and \code{final_model_pred}.}
\item{data_with_extremes}{A \code{data.frame} / \code{tibble} that appends the extreme social positions (0 and 1) and their predicted values (from emmeans). Useful for plotting extremes.}
}
\description{
Computes the Slope Index of Inequality (SII) between the extreme social groups defined based on a
numeric equity stratifier. The function operates in two modes: \strong{(Mode A)} using a numerator and
denominator (\code{health_numerator} and \code{health_denominator}), which is the preferred
and most accurate method, as it relies directly on event counts;
and \strong{(Mode B)} using an aggregated health indicator (\code{health_indicator})
and population weights (\code{population_weights}), which approximates the index based on weighted group means.
The function also provides automatic interpretations of the results in
four languages: Spanish, English, French, and Portuguese.
}
\details{
In both cases, the social stratifier is transformed into a relative social position (ridit)
ranging from 0 (most disadvantaged) to 1 (most advantaged), ensuring that \emph{position 0}
corresponds to the most disadvantaged and \emph{position 1} to the most advantaged
(as defined by \code{higher_ineq_is_favorable}). The SII is calculated as the absolute difference in the health indicator \eqn{y}
—predicted from the regression model at the two extremes— between the most disadvantaged and the most advantaged positions: \eqn{\mathrm{SII} = \hat{y}_{\text{disadvantaged}} - \hat{y}_{\text{advantaged}}}.

\subsection{A) Using numerator and denominator (preferred)}{
This method calculates the health indicator directly from event counts and denominators, ensuring statistical robustness.

\itemize{
\item \strong{Proportions}: The SII is computed using binomial, linear or logit-linear regression models.
\item \strong{Rates}: The SII is estimated from Poisson, negative binomial, or log-linear regression models, scaled by \code{rate_scaling_factor}.
\item \emph{This mode does not require population weights}: estimates are based on observed event counts.
}
}

\subsection{B) Using aggregated indicator and population weights (approximate)}{
This method approximates the SII based on weighted means.

\itemize{
\item \strong{Proportions}: Quasibinomial or logit-linear models are used.
\item \strong{Rates}: Linear or log-linear regression models with weights are applied.
\item \emph{Warning}: Results may be biased when using small samples or aggregated data. Prefer Mode A when possible.
}
}
}
\note{
Mode B is designed for cases where only summary indicators and population weights are available. However, Mode A should be used whenever individual counts are accessible, as it yields more accurate and robust estimates.
}
\examples{
# ——— Mode A (preferred: numerator and denominator) ———

# Example with a rate indicator (e.g., maternal mortality ratio)
data(data1)
sii_luna(
  health_indicator_type    = "rate",
  unit_analysis            = data1$zone,
  health_numerator         = data1$maternal_deaths,
  health_denominator       = data1$live_births,
  equity_stratifier        = data1$ubn_percent,
  higher_ineq_is_favorable = FALSE,
  rate_scaling_factor      = 100000,
  models = c('poisson', 'negative binomial'),
  model_evaluation_metric = 'MSE',
  conf_level               = 0.95,
  language_interpretation  = "en"
)

# Example with a proportion indicator (e.g., skilled birth attendance)
data(data2)
sii_luna(
  unit_analysis            = data2$zone,
  health_numerator         = data2$skilled_births,
  health_denominator       = data2$total_births,
  equity_stratifier        = data2$ubn_percent,
  higher_ineq_is_favorable = FALSE,
  health_indicator_type    = "proportion",
  models = c('binomial', 'linear logit(y)'),
  model_evaluation_metric = 'MSE',
  conf_level               = 0.95,
  language_interpretation  = "en"
)

# ——— Mode B (aggregated indicator + population as weight) ———

# Example with rate indicator
data(data1)
sii_luna(
  unit_analysis            = data1$zone,
  health_indicator         = data1$mmr,
  equity_stratifier        = data1$ubn_percent,
  population_weights       = data1$population_zone,
  higher_ineq_is_favorable = FALSE,
  health_indicator_type    = "rate",
  models = c('linear ln(y)'),
  model_evaluation_metric = 'MSE',
  rate_scaling_factor      = 100000,
  conf_level               = 0.95,
  language_interpretation  = "en"
)

# Example with proportion indicator
data(data2)
sii_luna(
  unit_analysis            = data2$zone,
  health_indicator         = data2$skilled_births_prop,
  equity_stratifier        = data2$ubn_percent,
  population_weights       = data2$population,
  higher_ineq_is_favorable = FALSE,
  health_indicator_type    = "proportion",
  models = c('quasibinomial', 'linear logit(y)'),
  model_evaluation_metric = 'MSE',
  conf_level               = 0.95,
  language_interpretation  = "en"
)

}
\references{
World Health Organization. Handbook on health inequality monitoring with a special focus on low- and middle-income countries. 2013.
Available from: https://www.who.int/publications/i/item/9789241548632
}
\seealso{
\code{emmeans::emmeans}, \code{sandwich::vcovHC}, \code{Metrics}
}
\author{
Adrián Vázquez-Mejía, MD MSc(c) (\email{apvasquez.md@gmail.com})
\cr Independent Consultant

Oscar J. Mújica, MD MPH (\email{mujicaos@paho.org})
\cr Pan American Health Organization (PAHO), Washington D.C.

Antonio Sanhueza, PhD (\email{sanhueza@paho.org})
\cr Pan American Health Organization (PAHO), Washington D.C.
}
